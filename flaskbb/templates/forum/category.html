{% extends "layout.html" %}
{% block content %}

<ol class="breadcrumb">
    <li><a href="{{ url_for('forum.index') }}">Forum</a></li>
    <li class="active">{{ category.keys()[0].title }}</li>
</ol>

{% for category in category.iteritems() %}
<table class="table table-bordered">
    <thead class="categoryhead">
        <tr>
            <td colspan="5">
                <div><strong><a href="{{ url_for('forum.view_category', category_id=category[0].id) }}">{{ category[0].title }}</a></strong></div>
            </td>
        </tr>
    </thead>
    <tbody class="forumbody">
        <tr class="forum_stats">
            <td colspan="2"><strong>Forum</strong></td>
            <td width="85" align="center" style="white-space: nowrap"><strong>Topics</strong></td>
            <td width="85" align="center" style="white-space: nowrap"><strong>Posts</strong></td>
            <td width="200" align="center" style="white-space: nowrap"><strong>Last Post</strong></td>
        </tr>

        {% for forum in category[1] %}
        <tr>
            <td align="center" valign="center" width="4%">

            {% if forum[0]|forum_is_unread(forum[1], current_user) %}
                <span class="fa fa-comments" style="font-size: 2em"></span>
            {% else %}
                <span class="fa fa-comments-o" style="font-size: 2em"></span>
            {% endif %}

            </td>

            <td valign="top">
                <strong><a href="{{ url_for('forum.view_forum', forum_id=forum[0].id) }}">{{ forum[0].title }}</a></strong>

                <div class="forum-description">
                    {% autoescape false %}
                    {{ forum[0].description|markup }}
                    {% endautoescape %}
                </div>
            </td>

            <td valign="top" align="center" style="white-space: nowrap">{{ forum[0].topic_count }}</td>
            <td valign="top" align="center" style="white-space: nowrap">{{ forum[0].post_count }}</td>

            <td valign="top" align="right" style="white-space: nowrap">
                {% if forum[0].last_post_id %}
                <a href="{{ url_for('forum.view_post', post_id=forum[0].last_post_id) }}" title="{{ forum[0].last_post.topic.title }}">
                    <strong>{{ forum[0].last_post.topic.title|crop_title }}</strong>
                </a>
                <br />
                {{ forum[0].last_post.date_created|time_since }}<br />
                    {% if forum[0].last_post.user_id %}
                    by <a href="{{ url_for('user.profile', username=forum[0].last_post.user.username) }}">{{ forum[0].last_post.user.username }}</a>
                    {% else %}
                    {{ forum[0].last_post.username }}
                    {% endif %}
                {% else %}
                No posts
                {% endif %}
            </td>
        </tr>
        {% endfor %}

    </tbody>
</table>
{% endfor %}
{% endblock %}
